########## M6 L1 ############
######### Harvesting Credentials ###########

Introduction to Credential Harvesting
﻿
Credentials are used to access devices and systems on a given network. Credentials include user account names and passwords. According to MITRE ATT&CK Tactic Credential Access (TA0006), harvesting credentials consists of techniques for accessing, identifying, and stealing user account names and/or passwords. Techniques used to obtain credentials include keylogging, Man-in-the-Middle (MITM) attacks, phishing, and credential dumping. Specific techniques are detailed later in this lesson. The use of legitimate credentials gives adversaries access to systems, making them harder to detect, and provides the opportunity to create more accounts to help achieve their goals. 


Credential harvesting is a tactic in the Enterprise Framework from MITRE ATT&CK, as shown in Figure 6.1-1:

﻿![image](https://github.com/user-attachments/assets/138c5875-3617-47c0-8217-fe69b7edbcbf)

Credential harvesting is also included in the reconnaissance phase of the MITRE ATT&CK Framework. According to MITRE ATT&CK, "the reconnaissance phase consists of techniques used and data that adversaries gather that can be leveraged to aid or help coordinate future campaigns or attacks, which likely occur later within the MITRE ATT&CK Framework. The data collected during the reconnaissance phase can be collected in an active or passive manner and information may include data points related to target systems, users, architecture, devices, or infrastructure."


Active data collection occurs when the adversary has infiltrated the target network in an attempt to identify and leverage any vulnerabilities and collect information available. Comparatively, passive data collection is not as infiltrated in the target network. Passive data collection occurs when the adversary is not actively manipulating or searching on the target network, rather, the adversary may be listening or watching traffic.

---------------------------------------------------------------------------------------

Credential Harvesting Techniques 
Brute Force Attacks and Credential Harvesting
﻿

Credential harvesting is categorized under the MITRE ATT&CK technique for brute force attacks (T1110). Brute force attacks include techniques that can be used when the password portion of credential information is not known. Brute force includes the following sub-techniques:

![image](https://github.com/user-attachments/assets/2a0637e8-8856-4aa1-bd8f-70f785b0ef33)

Additional Credential Harvesting Techniques


Multiple credential harvesting techniques exist that do not fall under the brute force attack techniques. Below are the techniques:

![image](https://github.com/user-attachments/assets/d609ad4a-f817-4586-a590-12711c951842)

--------------------------------------------------------------------------

Defenses Against Credential Harvesting
The primary defense against credential harvesting is strong password management. Enforcing all password settings ensures that passwords are complex, changed frequently, and require two-factor authentication. Below are three strategies that should be implemented to prevent credential harvesting:

![image](https://github.com/user-attachments/assets/7a4890a9-c2e7-4cd7-bdb8-0517eae55e8a)

--------------------------------------------------------------------

Harvesting Credentials by Password Spraying | Part 1
﻿

Walk through the MITRE ATT&CK technique of password spraying, as seen from an adversarial perspective. A small dump of credentials was obtained through a successful phishing attack. Using the information from the dump, a small password spraying attack is conducted in an attempt to access the network. 

------------------------------------------------------------------

rotecting Credential Data from Harvesting
Walk through accessing the network's primary Domain Controller (DC) to configure and enforce strict password settings in an effort to prevent credential harvesting. 

﻿

Workflow

﻿

1. Log in to the ch-dc1 VM using the following credentials:

Username: trainee
Password: CyberTraining1!
﻿

2. The domain's password policy can be easily reviewed using PowerShell. To do so, select the Windows icon > Administrative Tools.

﻿

3. In the Administrative Tools window, select Windows PowerShell.

![image](https://github.com/user-attachments/assets/2a52cd98-5aa7-454c-8225-5ad721b8bad5)

. In the Windows PowerShell window, enter the following cmdlet:
PS C:\Users\trainee.vcch> Get-ADDefaultDomainPasswordPolicy



The following results are returned:

![image](https://github.com/user-attachments/assets/f8a6de3d-61ec-402d-997f-582a4aca35cf)

Below are relevant fields to the domain's password policy from the Windows PowerShell output:

![image](https://github.com/user-attachments/assets/287f05dd-26db-498d-8d85-ffa896149f62)

The current domain password policy is not secure to prevent brute force attacks. Currently, passwords are only required to be one character long, changed once every 365 days, and can be changed to a password that was previously used. These three fields create an environment that is extremely vulnerable. The next steps identify how to modify and harden the domain's password policy.


5.  Select the Windows icon > Administrative Tools. Select Group Policy Management:

![image](https://github.com/user-attachments/assets/d6024e91-5e9d-48fb-aae4-55918006a8e4)

The Group Policy Management window opens:

![image](https://github.com/user-attachments/assets/4b32d344-08ba-4d96-a1b8-238281f1f77e)

Navigate to Group Policy Management > Forest: vcch.lan > Domains > vcch.lan > Default Domain Policy:

![image](https://github.com/user-attachments/assets/82130082-96ad-4be3-b030-9d5f790fdc7b)

Right-click Default Domain Policy and select Edit... The Group Policy Management Editor appears:

![image](https://github.com/user-attachments/assets/f3c8f960-91fe-4395-aded-4c5bc2163b4f)

8. Navigate to Computer Configuration > Policies > Windows Settings > Security Settings > Account Policies > Password Policy:

![image](https://github.com/user-attachments/assets/f918aaab-df80-4555-b492-caecf49fb730)

The password policy for the Default Domain Policy is located here. 


Notice that the output from the cmdlet executed in step 4 reflects the Policy Settings located in the Group Policy Management Editor:

![image](https://github.com/user-attachments/assets/b78fce0a-44bd-453b-b067-a2311af53866)


The current password policy settings are not strong:
Only require one character long.
Changed once every 365 days.
Changed to a previously used password.

9. Right-click Enforce password history and select Properties.

![image](https://github.com/user-attachments/assets/cdf0cce1-cd75-40dd-829f-71f98ea5d8a4)

he Enforce password history Properties window appears:

![image](https://github.com/user-attachments/assets/2e627f4e-3462-48b0-b0d6-88c84dcc6f0c)


10. Ensure Define this policy setting is checked. Set the passwords remembered to 24: 

![image](https://github.com/user-attachments/assets/915150c7-7ab8-4852-961b-6510092a9787)

NOTE: The maximum number of passwords Windows can remember is 24. 


11. Select Apply > OK.


12. Right-click Maximum password age, select Properties, and repeat the instructions from step 9. Set the password expiration to 60 days. 


13. In the Suggested Value Changes dialog box, select OK. 

![image](https://github.com/user-attachments/assets/cace6aa6-7434-453c-8d3c-3b8696764c3c)

14.  Select Minimum password age and repeat the instructions from step 9; set the password expiration to 1 days. 


15.  Select Password must meet complexity requirements, enable Define this policy setting, and select Enabled. Select Apply > OK.


16.  Select Store password using reversible encryption, and ensure Define this policy setting is unchecked. Select Apply > OK.


The Group Policy Management Editor should look like the following:


![image](https://github.com/user-attachments/assets/15f982c6-fd8b-4b12-aa9f-0f422fb57a53)


he Password Policy for the Default Domain Policy has been modified to enforce password settings that harden the domain. The password settings create an environment that is more difficult for the adversary to perform an attack using a brute force tactic.


NOTE: When creating a new GPO, the final step is to link the GPO to AD containing the desired groups and machines.

-------------------------------------------------------------------------------

Configure a GPO

The Virtual City City Hall (VCCH) network is taking on some new roles to support the monitoring of security in the network. The new roles require some machines on the network to contain highly sensitive information. Access to the machines and the data is highly controlled and requires a secure policy regarding credentials. Configure a GPO titled Security Control to support new security roles.

﻿

Workflow

﻿

1. Log in to the VCCH's primary DC — ch-dc1 — using the following credentials:

Username: trainee
Password: CyberTraining1!

----------------------------------------------------------------

GPO Access and Configuration
﻿
![image](https://github.com/user-attachments/assets/3bd3831f-ddf1-4eba-add1-6da91846fbc3)

Figure 6.1-20

﻿

The Group Policy Management provides access to view and manage GPOs within a given domain. 
![image](https://github.com/user-attachments/assets/6f1e8904-d83f-4c61-9497-0cb656d82eab)

-----------------------------------------------------------------

GPOs in VCCH
﻿

Figure 6.1-21

﻿

The Group Policy Objects folder contains all the domain's current GPOs.

﻿

NOTE: The following steps continue from the previous task.

﻿

2. Create a new group policy object titled Security Control, and access the GPO's password policy settings.

![image](https://github.com/user-attachments/assets/3b5a90f5-2837-4818-a3af-7738ec133162)

-----------------------------------------------------

Password Policy Settings
The following path leads to the GPO's password policy setting: 

﻿

﻿![image](https://github.com/user-attachments/assets/4c2c444f-89a2-450d-8ec6-78fee39c128c)


Figure 6.1-22

﻿

NOTE: The following steps continue from the previous task.

﻿

3. Edit the newly created GPO to enforce the password settings provided below.

Enforce password history: 24

Maximum password age: 30

Minimum password age: 1

Minimum password length: 12

Password must meet complexity requirements: Enabled

![image](https://github.com/user-attachments/assets/5452a657-cf31-497b-b64e-0425f7e02dbe)


---------------------------------------------------------------------------------------------------

Configured GPO
The required changes are made to the GPO:

﻿![image](https://github.com/user-attachments/assets/ecd93a97-3e60-4ea7-a2f9-fdac74604334)

The final step to enforce the new GPO is to link it to AD.


NOTE: The following steps continue from the previous task.


4. Once Link an Existing GPO... and Security Control are selected, the newly created GPO is added to the group policy objects found under vcch.lan:

![image](https://github.com/user-attachments/assets/070b7be2-9847-4d0d-bfc9-64c1a9ac1033)

![image](https://github.com/user-attachments/assets/148e3d54-3d03-46d4-b8ad-57f29ac4ea71)

From this point, the domain administrator from within the security group manages the GPO. They add users and computers as needed to handle and view sensitive information. The established policies put the domain in a secure posture to defend against credential harvesting through password mismanagement. 

----------------------------------------










