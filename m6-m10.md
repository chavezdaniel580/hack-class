########## M6 L1 ############
######### Harvesting Credentials ###########

Introduction to Credential Harvesting
﻿
Credentials are used to access devices and systems on a given network. Credentials include user account names and passwords. According to MITRE ATT&CK Tactic Credential Access (TA0006), harvesting credentials consists of techniques for accessing, identifying, and stealing user account names and/or passwords. Techniques used to obtain credentials include keylogging, Man-in-the-Middle (MITM) attacks, phishing, and credential dumping. Specific techniques are detailed later in this lesson. The use of legitimate credentials gives adversaries access to systems, making them harder to detect, and provides the opportunity to create more accounts to help achieve their goals. 


Credential harvesting is a tactic in the Enterprise Framework from MITRE ATT&CK, as shown in Figure 6.1-1:

﻿![image](https://github.com/user-attachments/assets/138c5875-3617-47c0-8217-fe69b7edbcbf)

Credential harvesting is also included in the reconnaissance phase of the MITRE ATT&CK Framework. According to MITRE ATT&CK, "the reconnaissance phase consists of techniques used and data that adversaries gather that can be leveraged to aid or help coordinate future campaigns or attacks, which likely occur later within the MITRE ATT&CK Framework. The data collected during the reconnaissance phase can be collected in an active or passive manner and information may include data points related to target systems, users, architecture, devices, or infrastructure."


Active data collection occurs when the adversary has infiltrated the target network in an attempt to identify and leverage any vulnerabilities and collect information available. Comparatively, passive data collection is not as infiltrated in the target network. Passive data collection occurs when the adversary is not actively manipulating or searching on the target network, rather, the adversary may be listening or watching traffic.

---------------------------------------------------------------------------------------

Credential Harvesting Techniques 
Brute Force Attacks and Credential Harvesting
﻿

Credential harvesting is categorized under the MITRE ATT&CK technique for brute force attacks (T1110). Brute force attacks include techniques that can be used when the password portion of credential information is not known. Brute force includes the following sub-techniques:

![image](https://github.com/user-attachments/assets/2a0637e8-8856-4aa1-bd8f-70f785b0ef33)

Additional Credential Harvesting Techniques


Multiple credential harvesting techniques exist that do not fall under the brute force attack techniques. Below are the techniques:

![image](https://github.com/user-attachments/assets/d609ad4a-f817-4586-a590-12711c951842)

--------------------------------------------------------------------------

Defenses Against Credential Harvesting
The primary defense against credential harvesting is strong password management. Enforcing all password settings ensures that passwords are complex, changed frequently, and require two-factor authentication. Below are three strategies that should be implemented to prevent credential harvesting:

![image](https://github.com/user-attachments/assets/7a4890a9-c2e7-4cd7-bdb8-0517eae55e8a)

--------------------------------------------------------------------

Harvesting Credentials by Password Spraying | Part 1
﻿

Walk through the MITRE ATT&CK technique of password spraying, as seen from an adversarial perspective. A small dump of credentials was obtained through a successful phishing attack. Using the information from the dump, a small password spraying attack is conducted in an attempt to access the network. 

------------------------------------------------------------------

rotecting Credential Data from Harvesting
Walk through accessing the network's primary Domain Controller (DC) to configure and enforce strict password settings in an effort to prevent credential harvesting. 

﻿

Workflow

﻿

1. Log in to the ch-dc1 VM using the following credentials:

Username: trainee
Password: CyberTraining1!
﻿

2. The domain's password policy can be easily reviewed using PowerShell. To do so, select the Windows icon > Administrative Tools.

﻿

3. In the Administrative Tools window, select Windows PowerShell.

![image](https://github.com/user-attachments/assets/2a52cd98-5aa7-454c-8225-5ad721b8bad5)

. In the Windows PowerShell window, enter the following cmdlet:
PS C:\Users\trainee.vcch> Get-ADDefaultDomainPasswordPolicy



The following results are returned:

![image](https://github.com/user-attachments/assets/f8a6de3d-61ec-402d-997f-582a4aca35cf)

Below are relevant fields to the domain's password policy from the Windows PowerShell output:

![image](https://github.com/user-attachments/assets/287f05dd-26db-498d-8d85-ffa896149f62)

The current domain password policy is not secure to prevent brute force attacks. Currently, passwords are only required to be one character long, changed once every 365 days, and can be changed to a password that was previously used. These three fields create an environment that is extremely vulnerable. The next steps identify how to modify and harden the domain's password policy.


5.  Select the Windows icon > Administrative Tools. Select Group Policy Management:

![image](https://github.com/user-attachments/assets/d6024e91-5e9d-48fb-aae4-55918006a8e4)

The Group Policy Management window opens:

![image](https://github.com/user-attachments/assets/4b32d344-08ba-4d96-a1b8-238281f1f77e)

Navigate to Group Policy Management > Forest: vcch.lan > Domains > vcch.lan > Default Domain Policy:

![image](https://github.com/user-attachments/assets/82130082-96ad-4be3-b030-9d5f790fdc7b)

Right-click Default Domain Policy and select Edit... The Group Policy Management Editor appears:

![image](https://github.com/user-attachments/assets/f3c8f960-91fe-4395-aded-4c5bc2163b4f)

8. Navigate to Computer Configuration > Policies > Windows Settings > Security Settings > Account Policies > Password Policy:

![image](https://github.com/user-attachments/assets/f918aaab-df80-4555-b492-caecf49fb730)

The password policy for the Default Domain Policy is located here. 


Notice that the output from the cmdlet executed in step 4 reflects the Policy Settings located in the Group Policy Management Editor:

![image](https://github.com/user-attachments/assets/b78fce0a-44bd-453b-b067-a2311af53866)


The current password policy settings are not strong:
Only require one character long.
Changed once every 365 days.
Changed to a previously used password.

9. Right-click Enforce password history and select Properties.

![image](https://github.com/user-attachments/assets/cdf0cce1-cd75-40dd-829f-71f98ea5d8a4)

he Enforce password history Properties window appears:

![image](https://github.com/user-attachments/assets/2e627f4e-3462-48b0-b0d6-88c84dcc6f0c)


10. Ensure Define this policy setting is checked. Set the passwords remembered to 24: 

![image](https://github.com/user-attachments/assets/915150c7-7ab8-4852-961b-6510092a9787)

NOTE: The maximum number of passwords Windows can remember is 24. 


11. Select Apply > OK.


12. Right-click Maximum password age, select Properties, and repeat the instructions from step 9. Set the password expiration to 60 days. 


13. In the Suggested Value Changes dialog box, select OK. 

![image](https://github.com/user-attachments/assets/cace6aa6-7434-453c-8d3c-3b8696764c3c)

14.  Select Minimum password age and repeat the instructions from step 9; set the password expiration to 1 days. 


15.  Select Password must meet complexity requirements, enable Define this policy setting, and select Enabled. Select Apply > OK.


16.  Select Store password using reversible encryption, and ensure Define this policy setting is unchecked. Select Apply > OK.


The Group Policy Management Editor should look like the following:


![image](https://github.com/user-attachments/assets/15f982c6-fd8b-4b12-aa9f-0f422fb57a53)


he Password Policy for the Default Domain Policy has been modified to enforce password settings that harden the domain. The password settings create an environment that is more difficult for the adversary to perform an attack using a brute force tactic.


NOTE: When creating a new GPO, the final step is to link the GPO to AD containing the desired groups and machines.

-------------------------------------------------------------------------------

Configure a GPO

The Virtual City City Hall (VCCH) network is taking on some new roles to support the monitoring of security in the network. The new roles require some machines on the network to contain highly sensitive information. Access to the machines and the data is highly controlled and requires a secure policy regarding credentials. Configure a GPO titled Security Control to support new security roles.

﻿

Workflow

﻿

1. Log in to the VCCH's primary DC — ch-dc1 — using the following credentials:

Username: trainee
Password: CyberTraining1!

----------------------------------------------------------------

GPO Access and Configuration
﻿
![image](https://github.com/user-attachments/assets/3bd3831f-ddf1-4eba-add1-6da91846fbc3)

Figure 6.1-20

﻿

The Group Policy Management provides access to view and manage GPOs within a given domain. 
![image](https://github.com/user-attachments/assets/6f1e8904-d83f-4c61-9497-0cb656d82eab)

-----------------------------------------------------------------

GPOs in VCCH
﻿

Figure 6.1-21

﻿

The Group Policy Objects folder contains all the domain's current GPOs.

﻿

NOTE: The following steps continue from the previous task.

﻿

2. Create a new group policy object titled Security Control, and access the GPO's password policy settings.

![image](https://github.com/user-attachments/assets/3b5a90f5-2837-4818-a3af-7738ec133162)

-----------------------------------------------------

Password Policy Settings
The following path leads to the GPO's password policy setting: 

﻿

﻿![image](https://github.com/user-attachments/assets/4c2c444f-89a2-450d-8ec6-78fee39c128c)


Figure 6.1-22

﻿

NOTE: The following steps continue from the previous task.

﻿

3. Edit the newly created GPO to enforce the password settings provided below.

Enforce password history: 24

Maximum password age: 30

Minimum password age: 1

Minimum password length: 12

Password must meet complexity requirements: Enabled

![image](https://github.com/user-attachments/assets/5452a657-cf31-497b-b64e-0425f7e02dbe)


---------------------------------------------------------------------------------------------------

Configured GPO
The required changes are made to the GPO:

﻿![image](https://github.com/user-attachments/assets/ecd93a97-3e60-4ea7-a2f9-fdac74604334)

The final step to enforce the new GPO is to link it to AD.


NOTE: The following steps continue from the previous task.


4. Once Link an Existing GPO... and Security Control are selected, the newly created GPO is added to the group policy objects found under vcch.lan:

![image](https://github.com/user-attachments/assets/070b7be2-9847-4d0d-bfc9-64c1a9ac1033)

![image](https://github.com/user-attachments/assets/148e3d54-3d03-46d4-b8ad-57f29ac4ea71)

From this point, the domain administrator from within the security group manages the GPO. They add users and computers as needed to handle and view sensitive information. The established policies put the domain in a secure posture to defend against credential harvesting through password mismanagement. 

----------------------------------------
########## M6 L2 ############
######### Identifying Hosts and Services ###########

Workflow


1. Log in to the kali-hunt Virtual Machine (VM) using the following credentials:
Username: trainee
Password: CyberTraining1!



2. Netcat comes on several distributions, but it may not always be installed on yours. Open a terminal window and run the following command to verify that Netcat is installed on the machine:
(trainee@dmss-kali)-[~] $ which nc

![image](https://github.com/user-attachments/assets/aba2b87d-1899-4b82-933b-335bfe7919b1)


Netcat is present on the system and located in /usr/bin/nc.


3. Run the following command to view the available options available for the utility:
(trainee@dmss-kali)-[~] $ nc -h

![image](https://github.com/user-attachments/assets/f9352d9e-cb78-4ad7-ada3-2f1d2db196f8)

The options used in the next step are -n, -v, and -w.


4. Run the following command to scan a host in the range's DMZ network:
(trainee@dmss-kali)-[~] $ nc -nvw 10 172.35.3.6 80



The complete command is explained as follows:
-n: Do not perform any lookups of addresses, hostnames, or ports
-v: Increase verbosity
-w: Set a timeout. In this case, Netcat waits 10 seconds before giving up attempting to establish a connection.

The host being scanned is 172.35.3.6, whose primary function is as a web server.


The port being scanned is 80 or HTTP.

![image](https://github.com/user-attachments/assets/60b5aa3f-ca60-4f34-a1d0-71c7b30a6f09)

Notice that upon connection, the client hangs. At this point in time, the TCP connection has been established and the client can send and receive data, if desired. The takeaway from this action, however, is that the port is open.


5. Select CTRL+C to close the connection.


At times, the CDA may want to scan multiple ports at once. This is where the -z option comes in handy. -z indicates that Netcat sends zero data; it simply establishes the TCP handshake, and closes the connection automatically, if it can be established. This is preferable to the alternative of selecting CTRL+C after every port.


The nc command also takes multiple ports or port ranges to check various services on a host. For example, the following are valid syntaxes:
nc -nvz 8.8.8.8 20-25       #Scans ports 20, 21, 22, 23, 24, and 25
nc -nvz 8.8.8.8 22 23 80    #Scans ports 22, 23, and 80
nc -nvz 8.8.8.8 20-25 80    #Scans ports 20, 21, 21, 23, 24, 25, and 80



6. Run the following command to test if Secure Shell (SSH), TELNET, Simple Mail Transfer Protocol (SMTP), HTTP, HTTP Secure (HTTPS), and Post Office Protocol 3 (POP3) are open:
(trainee@dmss-kali)-[~] $ nc -nvz -w 10 172.35.1.21 22 23 25 80 443 110



In this case, the host being scanned is the core router in the range network.


NOTE: Netcat only prints outputs for ports that are open. All output can be seen by running the following command:
(trainee@dmss-kali)-[~] $ for port in 22 23 25 80 443 110; do nc -nvz -w 10 172.35.1.21 $port; done

![image](https://github.com/user-attachments/assets/04a74e5d-4a06-4ab1-ac10-7029353ddac7)

command to see what ports are listening 
![image](https://github.com/user-attachments/assets/248a1a98-0a0b-4d09-9870-e74e5d2f7558)

------------------------------------------------------

Port Scanning and Banner Grabbing with Netcat
The resulting output from the previous command is shown below:

![image](https://github.com/user-attachments/assets/c7df9017-a6b2-4eff-9807-09e513442acf)

As detailed, SSH is open on this device. Now that the open port is verified, perform a banner grab to get more information on the service.


NOTE: The following steps continue from the previous task.


7. Run the nc command without the -z option on the open port to perform a banner grab:
(trainee@dmss-kali)-[~] $ nc -nvw 10 172.35.1.21 22



Depending on the service running or how the service is configured, the server may not always return a banner or data. This was seen in the first port scan against HTTP; even with the socket left open, the server sent no data. 

![image](https://github.com/user-attachments/assets/56a99a98-8ee2-47ff-b355-51804a349464)

command to do a banner grab

![image](https://github.com/user-attachments/assets/dcbcf0f0-1480-4ab1-a4e9-b7efa9d3b790)

------------------------------------------------------------------------------------

Workflow


NOTE: The following steps continue from the previous task.


8. Check to see if Telnet is installed on the host:
(trainee@dmss-kali)-[~] $ which telnet



9. Run the following command to port scan and banner grab with Telnet:
(trainee@dmss-kali)-[~] $ telnet 172.35.1.21 22

![image](https://github.com/user-attachments/assets/1e1da70d-ba8d-493b-afb0-c6d30fc42ce9)

An open port is indicated by the Connected to 172.35.1.21 message. The banner is also displayed. As mentioned before with Netcat, a banner may not be returned based on the service or its configuration.


10. Select CTRL+C and Enter to close out the connection.


A closed port message appears as with Netcat. Recall in the previous steps, port 21 on the router was scanned and verified that the service was not running.


11. Run the following command to attempt to connect to TCP port 21 with Telnet:
(trainee@dmss-kali)-[~] $ telnet 172.35.1.21 21

![image](https://github.com/user-attachments/assets/3ab5ae7d-8332-43de-a1d4-04a64268ca8a)

----------------------------------------------------------------------------

Workflow


1. Log in to the kali-hunt VM using the following credentials:
Username: trainee
Password: CyberTraining1!



At a minimum, Nmap only needs a host to run.


2. Run the following command to conduct a Nmap scan against a host.
(trainee@dmss-kali)-[~] $ nmap 172.35.3.6

![image](https://github.com/user-attachments/assets/6a010bd7-fa1f-4fb4-870c-860f25675d72)

This conducts host discovery to ensure that the host is up, and conducts a scan of the 1,000 most popular TCP ports.


By default, Nmap conducts host discovery before commencing the port scan. With multiple hosts, this saves time by ensuring that a host is there before blasting thousands of packets. Nmap's default host discovery uses four packets: an ICMP echo request, a TCP probe to 80 and 443, and an ICMP Timestamp request. If the user has superuser privileges, the TCP probes are a TCP ACK to port 80 and TCP SYN to port 443. If the user only has regular user privileges, then the TCP probes are both SYN packets. However, many hosts have ICMP disabled and/or firewall rules in place so the default scan many not give the user the best results depending on the circumstances. While Nmap's host discovery can be tailored to better fit the environment, this is not covered in this lesson. To skip host discovery, for reasons such as the host is known to be up or due to the target environment configuration, use the option -Pn. For example, the following command implements skipping host discovery: 
(trainee@dmss-kali)-[~] $ nmap -Pn 8.8.8.8



NOTE: Superuser privileges are required whenever crafting raw packets as it requires lower level access, e.g., a stray ACK in the case of Nmap's host discovery.


Depending on the user privileges, the scan is a TCP SYN Stealth scan as a superuser or a TCP Connect scan as a regular user. A TCP SYN Stealth scan sends a SYN, and if it receives a SYN/ACK, it replies with a RST; it never completes a full connection. This is less likely to create logs, as many applications only create logs after a connection has been established. The switch for a TCP SYN Stealth scan is -sS.
(trainee@dmss-kali)-[~] $ nmap -sS 8.8.8.8  #Must be run as root or with sudo 



A TCP Connect scan completes the TCP handshake, then closes the connection. No special privileges are required to run this type of scan. The switch for a Full Connect scan is -sT. The following Nmap command is an example of a TCP Connect scan:
(trainee@dmss-kali)-[~] $ nmap -sT 8.8.8.8



Nmap also allows the user to specify ports, if desired, with the -p option. Listed below are some examples of valid syntax with the -p option:
nmap -sS 8.8.8.8 -p 22			#Scan port 22
nmap -sS 8.8.8.8 -p 1-100		#Scan ports 1-100
nmap -sS 8.8.8.8 -p 5,6,7,8,9	#Scan ports 5,6,7,8,9
nmap -sS 8.8.8.8 -p-			#Scan all 65,535 ports
nmap -sS 8.8.8.8 -p-25			#Scan all ports up to 25
nmap -sS 8.8.8.8 -p65530-		#Scan all ports above port 65530


base off this command 

(trainee@dmss-kali)-[~] $ nmap 172.35.3.6
![image](https://github.com/user-attachments/assets/e4d494e4-5483-4755-bbe4-d3971f2f82ad)

---------------------------------------

Workflow


NOTE: The following steps continue from the previous task.


3. In the kali-hunt VM, run the following command to enable service, version and OS detection on a host. The host in this command is the DNS server for the range network. The sudo command prompts for a password — CyberTraining1!
(trainee@dmss-kali)-[~] $ sudo nmap -sS -sV -O -Pn 172.35.3.2     

![image](https://github.com/user-attachments/assets/19290fcc-fe2d-4d64-9dd5-82b1f6f1c047)

Based on the results of the service version and OS detection, attempt to correlate publicly or privately known exploits to gain access. For example, since the DNS service was detected as Simple DNS Plus, use open-source research to determine if there are known exploits against that service. Finding exploits is covered in a future module.

---------------------------------------------------------------------------------------

Workflow


NOTE: The following steps continue from the previous task.


4. Start a packet capture to observe the traffic being sent to the host to scan. The host in this case is 172.35.3.6, which is a web server within the range network.
(trainee@dmss-kali)-[~] $ sudo tcpdump -i eth1 -nnn 'host 172.35.3.7'

![image](https://github.com/user-attachments/assets/c33bba0f-5c1a-474a-b995-19dd8fd14a5b)

5. In a new window, run the following command to initiate a SYN Stealth scan against a web server host in the range network.
(trainee@dmss-kali)-[~] $ sudo nmap -sS -Pn 172.35.3.7

![image](https://github.com/user-attachments/assets/68ae505a-cbf4-46cc-bbc5-cfe56e6cbd97)

The packets can be seen leaving the kali host.

![image](https://github.com/user-attachments/assets/65cbabce-bca3-4fe4-9130-a3888f44edd3)

However, when the scan completes, it appears as if there is a firewall along the path to the device that is filtering traffic. Observe the packet capture. No response is ever generated from the host being scanned, so Nmap assumes that the host is filtered. Note that with the -Pn option, Nmap assumes a host is filtered if the host is not up.

![image](https://github.com/user-attachments/assets/5c6da4b4-f863-4716-87ba-89218b8f1882)

6. Run an ACK Scan to check if the firewall is stateless. To save time, only one port is scanned, which in this case, is 22.
(trainee@dmss-kali)-[~] $ sudo nmap -sA -Pn -p 22 172.35.3.7

![image](https://github.com/user-attachments/assets/fea29c5f-5e05-4f4d-a1ff-ec445a16f6ae)

Nmap reports this port as unfiltered. Observing the packet capture in the other window, it becomes evident why. This time, an RST response is received from the host.

![image](https://github.com/user-attachments/assets/27e978aa-03f4-4756-aaa7-e3de977387ed)

When a stateless firewall is found, the analyst can typically proceed with the other scans (i.e., NULL, FIN, XMAS). However, due to the underlying OSs within the range environment, the scans do not report accurate port state information. This is very common, as many modern OSs do not respond at all to these scans. 


7. Select CTRL+C to stop the tcpdump capture

--------------------------------------------------------------------------------------------

`Workflow


NOTE: The following steps continue from the previous task.


8. The host to investigate is a DNS server for the range network. Run the following command to scan the top 1,000 UDP ports:
(trainee@dmss-kali)-[~] $ sudo nmap -Pn -sU 172.35.3.2

![image](https://github.com/user-attachments/assets/b3b595a3-f1c7-484e-8d5a-0ce36ba488c2)

From the scan results, it appears that UDP port 53 is open, which corresponds to the DNS service.


NOTE: Nmap reports 999 other ports as open|filtered. Recall that this is due to UDP services not having a handshake as TCP services does, and is much more difficult to get a definitive state for.

--------------------------------------------------------

Workflow


NOTE: The steps continue from the previous task.


9. Run the following command to run a port scan for the range 20-25 with the aggressive timing template. This gives some idea of the time it takes to complete the scan.
(trainee@dmss-kali)-[~] $ sudo nmap -sS -Pn -T4 -p 20-25 172.35.3.1

![image](https://github.com/user-attachments/assets/e18803bd-3b4e-41e0-bc67-e66dc1c5c381)


The scan completes in 13.31 seconds for six ports on one host. Runtimes may differ slightly. 


10. Run the same command, only with the sneaky timing template (T1).
(trainee@dmss-kali)-[~] $ sudo nmap -sS -Pn -T1 -p 20-25 172.35.3.1

This may take a few minutes to run.


![image](https://github.com/user-attachments/assets/066feb2e-9090-47e2-8da4-898426c47ac0)

Note the time difference between the two: 13 seconds versus just under two minutes for just six ports. If detection is not a concern, then finishing port scans quickly is ideal. However, based on the presence and configuration of security systems within the network, it may be necessary to take more time to scan the network to prevent tipping of IDSs/IPSs.

--------------------------------------------------------------------------

Fun with ACAS
ACAS is the Department of Defense's (DoD's) pick when it comes to vulnerability scanners. It is a robust, highly-configurable tool that is easy to start using. Its web interface is user friendly and intuitive. Use ACAS to conduct a vulnerability assessment.

﻿

1. Log onto the kali-hunt VM using the following credentials:

Username: trainee
Password: CyberTraining1!
﻿

2. Open Firefox ESR from the desktop.


![image](https://github.com/user-attachments/assets/382bee91-02be-44b2-b570-bf8917fb5b6f)

Figure 6.2-23


3. Select the ACAS bookmark, and enter the following credentials to log in to the web page.
Username: trainee
Password: CyberTraining1!



4. Accept the DoD Notice and Consent Banner.


![image](https://github.com/user-attachments/assets/5d989a21-4635-4de6-9018-8060e18eac77)

5. Select New Scan.

![image](https://github.com/user-attachments/assets/fc416f08-482d-48ad-9709-cdd18967f918)

This displays the types of scan templates available to use.


6. Select Basic Network Scan.


The Basic Network Scan is a good choice when not much is known about the devices being scanned. In the Basic Network Scan, several options are preconfigured without allowing for changes. In scans such as the Advanced Scan, more options are available to change. For our purposes, the Basic Network Scan is a good starting point.

![image](https://github.com/user-attachments/assets/c7724341-7047-4829-98f5-7359b79c4b55)

7. Enter the following information in the fields:
Name: Core-Services-Scan
Description: Vulnerability scan of devices in the Core Services subnet.
Folder: My Scans
Targets: 172.35.2.0/24

![image](https://github.com/user-attachments/assets/656d32c0-638e-46dd-9fb5-df62557e0925)

The 172.35.2.0/24 range is the subnet containing the servers in the network that provide infrastructure and core functionality such as DNS and Active Directory (AD).


ACAS has functionality to enable scheduling of preconfigured scans. This can be accessed by selecting Schedule under General. This functionality is not used in this lesson.


![image](https://github.com/user-attachments/assets/a86a1841-4e2f-469e-9244-fca8d4e4e54d)

ACAS also has the functionality to email notifications to specified recipients. This can be configured by selecting Notifications under General. This functionality is not used in this lesson.

![image](https://github.com/user-attachments/assets/8a6eefb1-4600-4603-b893-d3f90ac61e5a)

The Discovery menu specifies how ACAS searches for hosts. There are limited options when using the Basic template; however, other scan templates allow more granularity. The default is used in this lab.

![image](https://github.com/user-attachments/assets/1397a602-dbef-4fb4-a0f0-9f217341034e)

The Assessment menu currently contains settings for web scans. In different scan templates in ACAS, there may be more options for different types of services. The default setting is used in this lab.

![image](https://github.com/user-attachments/assets/3650e0ba-aa83-42e5-aa7d-ffa9397bd7ba)

The Report menu specifies how the output is formatted. The default setting is used in this lab.

![image](https://github.com/user-attachments/assets/baad6b64-a475-42e0-8b97-b1e55bba1e2c)

The Advanced menu provides timing options for this scan. Depending on the bandwidth of the network and the load of the hosts, it may be desirable to configure this to network specifications. In this case, leave the defaults.

![image](https://github.com/user-attachments/assets/12a2b279-6101-415b-a528-ee17bdbe33f5)


8. Select Credentials > Windows, and enter the following information into the fields:
Authentication method: Password
Username: trainee
Password: CyberTraining1!
Domain: vcch.lan
Never send credentials in the clear: Enabled
Do not use NTLMv1 authentication: Enabled
Start the Remote Registry service during the scan: Disabled
Enable administrative shares during the scan: Disabled
Start the Server service during the scan: Enabled

![image](https://github.com/user-attachments/assets/be27ee04-cea8-4f41-aba2-2026ff473064)

The Plugins tab allows you to view the plugins used during the scan. With the Basic template, only the plugins used are visible. In other templates, plugins can be added or removed if information about the network is known. At this point in time, not much is known about the Core Services subnet, so the defaults are fine.

![image](https://github.com/user-attachments/assets/ad7952b4-a9c6-4d24-8232-f5c6acc96982)

9. Select Save.


This takes the trainee to the My Scans screen.

![image](https://github.com/user-attachments/assets/feeeb311-4582-478c-a164-d6c9df4b78d8)

10. Select the Play icon on the configured scan to begin the scan.


NOTE: This takes approximately 30 minutes to complete. Allow the scan to run in the background and continue with the next section of the lab while waiting for this to complete.

-----------------------------------------------------------------

Workflow


NOTE: The following steps continue from the previous task.


11. Run the following command to check what ports are open on the web server in the range environment.
(trainee@dmss-kali)-[~] $ sudo nmap -sS -T4 172.35.3.6

![image](https://github.com/user-attachments/assets/a28b6745-7934-493c-ad22-53cddc5bf2ff)

After determining which ports are open, the appropriate scripts can be selected. On this distribution, scripts included with Nmap are located in /usr/share/nmap/scripts.


The naming convention allows for easy searching as each script begins with the protocol or service it was intended for.


12. View which scripts are available for HTTP by running the following command:
(trainee@dmss-kali)-[~] $ ls /usr/share/nmap/scripts/http-*

![image](https://github.com/user-attachments/assets/b52cd481-599f-4410-9af7-99ff17aacdf9)

Some output has been truncated. To find more information about a particular script, use the --script-help option.


13. Find out more about the first HTTP script available — http-adobe-coldfusion-apsa1301.nse — by running the following command:
(trainee@dmss-kali)-[~] $ nmap --script-help http-adobe-coldfusion-apsa1301.nse

![image](https://github.com/user-attachments/assets/a41b22a7-5ada-4f40-bc1c-e2f40020b56e)

Notice the Categories line in the output. For this script, the categories are exploit and vuln. Nmap classifies their NSE scripts into different categories as listed in the attachment. This way, users can specify which category of scripts to run.


The -sC option enables the scripting engine, but to run specific scripts, use the --script option instead. The -sC option is the equivalent of --script=default. Default corresponds to the script category. 


The --script option allows for more granularity on what is run and accepts Boolean logic. For example, the string below is a valid argument for the script parameter:
--script "(http-* or postgresql-*) and (default or safe)"



This searches for scripts beginning with http or pgsql and only runs them if they are categorized as default or safe.


14. Run the following command to enable the NSE with the default scripts for each open port discovered from the previous scan:
(trainee@dmss-kali)-[~] $ sudo nmap -sC -p 80,443,5432 172.35.3.6



As shown below, NMAP was able to read the robots.txt file and examine the Transport Layer Security (TLS) certificates of the web and Postgresql server.

![image](https://github.com/user-attachments/assets/b917dcbd-a5ba-4ba0-9bcb-794005d34d06)

------------------------------------------------------------------------------

Workflow


NOTE: The following steps continue from the previous task.


15. Run the following command to scan a web server within the range environment with Nikto:
(trainee@dmss-kali)-[~] $ nikto -h 172.35.3.6



The -h specifies the host.

![image](https://github.com/user-attachments/assets/fd0d19aa-c15a-4ed3-b985-dbc9e59e185f)



The output from the scan is as explained:


Nikto was able to identify the version of the web server, which was Nginx 1.14.0 as per the first bullet. Nikto was also able to identify issues that may lead to clickjacking and XSS, as well as a potential rendering issue that may occur on web browsers from the following three bullets. Clickjacking is when an attacker uses transparent or opaque layers over the actual content of the page to cause a user to click on the attacker's link and sends the user to a malicious page. The clickjacking issue was discovered due to a lack of the X-Frame-Options header, as referenced by the second bullet in the output. The XSS issue comes from an absent X-XSS-Protection header, as evidenced by the third bullet. The potential rendering issue is also the result of a missing header, the X-Content-Type-Options header as per the fourth bullet.


The scan took 2 minutes and 36 seconds, which is reasonably short.

-----------------------------------------------------------------------------

Workflow


NOTE: The following steps continue from the previous task.


16. Select the Vulnerabilities tab.

![image](https://github.com/user-attachments/assets/0ce9c076-4f3e-4094-addf-0591439dcec3)


Notice that each individual vulnerability is grouped into a Family. It is possible to toggle the grouping with the gear icon, but this is not performed in this lesson.


17. Select the first Family: Microsoft Windows (Multiple Issues).

![image](https://github.com/user-attachments/assets/f7be0cf0-b3f4-44cd-9501-41300436b1c2)


This page displays a listing of vulnerabilities from most severe to least. From the scan report, one of the hosts is affected by a remote code execution vulnerability.


18. Select MS14-066 to find out more about it.

![image](https://github.com/user-attachments/assets/c424aeeb-d357-4f92-9bfc-a253cebead50)


A general Description, Solution, the Plugin Details used to detect the vulnerability, Risk Information, Vulnerability Information, etc., can be found under each vulnerability.


19. Use the scan results to answer the following questions.


-------------------------------------------------------------

Workflow


1. Log in to the kali-hunt VM using the following credentials:
Username: trainee
Password: CyberTraining1!



2. Open Firefox ESR, and select the Security Onion bookmark.


3. Enter the following credentials when prompted.
Username: trainee@jdmss.lan
Password: CyberTraining1!



4. After successfully logging in, select Kibana from the side menu, and navigate to the Discover page.


5. Set the time range to the following: Oct 12, 2021 @ 11:30:00 - Oct 12, 2021 @ 12:00:00.


6. Enter the following query in the search bar:
event.dataset:conn



This filters for all connection logs created by Zeek. There are 6,528 results. Also, there is an obvious bump where there was a surplus of traffic. 


![image](https://github.com/user-attachments/assets/36903b25-4ea7-4b09-a4c8-eb9de9588e2f)

7. Toggle the following fields:
   
source.ip

destination.ip

destination.port

connection.state

client.packets

server.packets

![image](https://github.com/user-attachments/assets/f544896b-3afe-4704-a32d-6608470e1ef3)

Connection states are values defined by Zeek and are broken out as follows:

![image](https://github.com/user-attachments/assets/b54a946c-b29c-4473-bfa5-eab180d738bc)

Typical connections end with SF.


A server with an open port scanned using a TCP Connect or SYN Stealth scan results in a connection.state with the code RSTO.


A server with a closed port scanned using a Connect or a SYN results in a REJ.


A server with a filtered port scanned using either a TCP SYN or Connect results in a state of S0.


Finally, a garbage package resulting from an ACK, FIN, Xmas, Null, Maimon, etc., scans results in OTH.


Putting this all together, a TCP Connect scan can be characterized by a single host attempting to connect to multiple ports; a short session length of only one packet (client SYN, filtered port), two packets (client SYN, server RST), or four packets(client SYN, server SYN/ACK, client ACK, client RST) between the client and the server; and a combination of S0 or REJ and SF. TCP SYN scans share many characteristics of TCP Connect scans, except the maximum amount of packets possible is three — the client SYN, the server SYN/ACK, and a following client RST.


8. Observe the connections that occurred during the traffic spike by selecting the 11:56 bar.


![image](https://github.com/user-attachments/assets/5ff7cebe-444b-4817-8f37-20008033fdb2)

It is evident that the host responsible for starting the scans is 199.63.64.51 after scrolling through the results and seeing several seemingly random ports with no responses. Also, ports are not opening are filtered, as indicated by the S0 connection state and no server packets. Recall that an unfiltered host returns a RST, resulting in a server.packet count of 1.

![image](https://github.com/user-attachments/assets/9a408669-aa5d-4d05-aa95-6f867be33773)

9. Filter for this host by running the following query:
event.dataset:conn and source.ip:199.63.64.51



To determine which type of scan it was, locate the behavior of the scan after an open port was found. This means that there are at least two client packets, the first being a SYN, and the second packet either being an ACK for a TCP Connect Scan or a RST for a SYN Stealth Scan.


10. Run the following query to check the behavior of the scanning host after an open port is detected:
event.dataset:conn and source.ip:199.63.64.51 and client.packets>=2

![image](https://github.com/user-attachments/assets/22b95743-1ebd-4e81-807b-2bb19a188c2d)


![image](https://github.com/user-attachments/assets/59063585-76bd-49b6-8ab3-f0fcaa78682f)

sends a rst which is a reset and is for sealth scans
![image](https://github.com/user-attachments/assets/8c9d14d5-cc61-4163-a8b0-81a276ba5d5d)


----------------------------------------------------------------------------

Workflow


NOTE: The following steps continue from the previous task.


11. Clear the current search and set the time range to October 12th, 2021 14:30 - October 12th, 2021 16:00. The columns toggled in the previous steps should still be set.

![image](https://github.com/user-attachments/assets/3569cda1-9b55-4fe8-9879-bb1c2e8bd6fb)

12. Run the following query to filter for only Zeek connection logs.
event.dataset:conn

![image](https://github.com/user-attachments/assets/607ed5aa-f283-4d4d-a3a6-deebabaf7273)

The scans are not nearly as obvious now. Recall that in the previous scan, there was a single large spike, but is not immediately noticeable here. The -T0 option was used to run this scan, which is why it blends in with the traffic much better. Luckily, there are a few methods of detecting these scans. The first method that was examined uses the behavioral characteristics of Nmap scans that were examined in previous steps. This time, search for packets generated by open AND closed ports. The purpose of this is to identify any potential port scanning behavior at all. A few port probes may be normal, but a large range of ports scanned by the same host appears more suspicious.


13. Run the following query to search for scanning behavior:
event.dataset:conn and source.ip:199.63.64.51 and ((client.packets>=1 and client.packets<=3) and server.packets<=1)



Now, the scanning becomes more apparent. 


![image](https://github.com/user-attachments/assets/11bb6a36-f475-46ff-8405-c81fa69acb29)

Scrolling through the results, there is a wide range of ports and short sessions, which points towards a port scanning attempt.


There are a few sessions with three client packets despite all being SYN packets. For all intents and purposes, they should be interpreted as their own connection.


The second detection method covered in this lesson uses Nmap's TCP options. Recall that Nmap uses TCP options to identify host OSs. Ironically, Nmap can be identified via its TCP options as well, namely its TCP Window Size. Nmap sets a default window size of 1024, which is not a typical window size. Typically, OSs have the maximum window size set, not including the scaling factor in the TCP options. This makes identification easier, as a scan can be detected in as little as a single packet. Currently, there is not an easy way to set the TCP Window Size using the Nmap utility itself without recompiling the program. Use the Suricata event module to identify Nmap scans.


14. Run the following query to filter for Suricata events:
event.module:suricata and message:NMAP

![image](https://github.com/user-attachments/assets/31f60747-295e-4641-a606-3d5aee685aff)

15. Toggle the following fields:
    
rule.name

message

![image](https://github.com/user-attachments/assets/4b01502e-cebe-4fd1-97d2-e917089c90f8)

As the rule.name and message fields state, a possible NMAP scan was detected. The rule used simply matches on window size, with the threshold to generate an alert being 5 packets in 60 seconds, which is why the graph does not exactly match up with the previous query.

nmap by deafult uses a window size of 1024

look for connections of 4 or more

and nmap can scan a wide range of ports

![image](https://github.com/user-attachments/assets/5f5da186-9455-403b-83bf-d5b3cde6c247)


-------------------------------------------------------------------------------


Workflow


NOTE: The following steps continue from the previous task.


16. Set the time range to the following: October 12, 2021 14:00 - October 12, 2021 15:00


![image](https://github.com/user-attachments/assets/d54b8d85-325b-47cb-9671-a9841acdd836)

17. Filter the events for Zeek connection logs:
event.dataset:conn

![image](https://github.com/user-attachments/assets/55b6eb15-aa22-4648-b9cd-61f9d66ce435)

As with Nmap, there is a huge spike in traffic. However, the traffic spike lasts longer than with a Nmap scan.


18. Select the highest point of the traffic spike, which begins at 14:08. Note that the beginning of the spike starts at 14:07, which is where port scanning occurs. This largely appears the same as Nmap scanning.

![image](https://github.com/user-attachments/assets/f0a20406-867f-4696-8ef0-8aa8edfe4e50)

![image](https://github.com/user-attachments/assets/bcffc3f5-d0fe-4dea-917d-8d806c5959c2)

how i got the answer

![image](https://github.com/user-attachments/assets/dab92296-290a-4bf9-89f3-b6c7fd8929fe)

-----------------------------------------------------------------------------------

Detecting Nikto Scans
Examine what Nikto scans look like in traffic.

Workflow


NOTE: The following steps continue from the previous task.


19. Set the time range to the following: October 12, 2021 16:30 - October 12, 2021 17:00


Unlike the other scans examined, Nikto scans are most prominent in Zeek HTTP Logs.


20. Filter for HTTP logs by running the following query:
event.dataset:http

![image](https://github.com/user-attachments/assets/d27c3388-2d39-4caa-9228-db1c8ada78bf)

Like the other scans, Nikto is marked by a significant uptick in traffic.


21. Select the highest peak which starts at 16:57.


22. Toggle the following fields:
source.ip
destination.ip
http.status_code
http.uri
http.request.body.length
http.response.body.length

![image](https://github.com/user-attachments/assets/bce22b7e-181f-4134-9429-143fa8a7c675)

Upon first glance, several HTTP 301s can be seen from 199.63.64.51. There are a few HTTP 404s that can be seen but may not come from 199.63.64.51.

![image](https://github.com/user-attachments/assets/c8234208-2c1a-465c-b5f6-9407a2f1a2e1)

If the source IP address was not known, then it is found by selecting the highest spike. However, this view is not much more useful as there is not much to glean, other than the excess of HTTP 301s.


23. Return the time range to October 12, 2021 16:30 - October 12, 2021 17:00, and run the following query to filter out web connections from different hosts:
event.dataset:http and source.ip:199.63.64.51

![image](https://github.com/user-attachments/assets/ed77df97-b99b-4f82-81a6-1b82573cc384)

After filtering for 199.63.64.51, much more spookiness is seen. First, notice the user agent string Mozilla/5.00 (Nikto/2.1.6) (Evasions:None) (Test:007239), which not only stands out, but lets the user know exactly what program is running the vulnerability scan. While script kiddies may not know to change the user agent value, it is trivial to do so by changing the user agent string in the config file.


Because of this, relying on the user agent to identify Nikto is not always reliable. However, the behavior is used to more consistently identify scanning attempts. Note the http.uri field. Nikto attempts to brute force several config files, security-related files, account files, database files, etc. This is not normal user behavior and can be marked as related to scanning activity. A signature that could catch this might trigger an alert if three or more different Uniform Resource Identifiers (URI) from the results are requested. Nikto has built-in evasion techniques to attempt circumvention.


24. Set the time range to October 12, 2021 17:00 - October 12, 2021 17:30. Do not clear the current query or any fields.

![image](https://github.com/user-attachments/assets/3e5d4246-7651-4037-9592-4f35880eecc7)



This Nikto scan used an IDS evasion technique. Scrolling through the results, it is evident that some URIs are using Uniform Resource Locator (URL) encoding, which may circumvent some signatures. URL encoding enables characters outside of the ascii range and special characters. URL uses the percent sign (%) and hexadecimal to encode characters, e.g. a space is encoded as %20. to be transmitted over the Internet. In the data, we can see a %27, which is the ' character encoded. Nikto does not have a timing option, however, and abnormal traffic patterns such as spikes can trigger alerts if the evasion techniques avoid signatures.







































































































































































































